name: deploy docker image to ec2

on: 
    push

jobs:
    build:
        runs-on: self-hosted

        steps:
          - name: code check
            uses: actions/checkout@v3 
          - name: log in to dockerHUB
            uses: docker/login-action@v2
            with:
                username: ${{secrets.DOCKER_USERNAME}}
                password: ${{secrets.DOCKER_PASSWORD}}
                
          - name: log in to ec2 instance
            uses: appleboy/ssh-action@master
            with:
                host: ${{ secrets.EC2_HOST }}
                username: ${{ secrets.EC2_USERNAME }}
                key: ${{ secrets.EC2_PRIVATE_KEY}}
                passphrase: ${{ secrets.EC2_PRIVATE_KEY_PASSPHRASE }}

    